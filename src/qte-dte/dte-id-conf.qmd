--- 
description: "Learn to  (Lecture Notes)"

open-graph:
    description: "Learn to  (Lecture Notes)"
---
 
# Nonparametric Identification of Distributional Treatment Effects under Unconfoundedness {#sec-dte-id-conf}

::: {.callout-note appearance="simple" icon=false}

## Summary and Learning Outcomes

This section  

By the end of this section, you should be able to:

- Identify 

:::
    


## Setting 
 
In the simple RCT setting of the previous section, identification of QTE and DTEs is particularly simple. The required quantile and distribution functions can be directly obtained from conditional quantile and distribution functions of the realized outcomes. 

However, in practice, it is more frequent and realistic to see a weaker (conditional) unconfoundedness assumption, which requires that the realized treatment $X_i$ and the collection of potential outcomes $\curl{Y_i^x}_x$ are independent only conditionally on some  covariates $W_i$:
$$
 \curl{Y_i^x}_x \independent X_i|W_i.
$$ {#eq-qte-unconf}
This setting is depicted on @fig-swig-obs. The setting of @eq-qte-unconf may correspond both to observational settings and experiments with stratification.
 
::: {#fig-swig-obs}

``` tikz

\begin{tikzpicture}[thick, scale=30, every path/.style={color=gray!70}]
    
    \node (v1) at (0.397,-0.432) {$X_i|x$};
    \node (v2) at (0.573,-0.432) {$Y^x_i$}; 
    \node (v3) at (0.367,-0.322) {$W_i$}; 
    \draw [->] (v1) -- (v2); 
    \draw [->] (v3) -- (v2);
    \draw [->] (v3) -- (v1);
\end{tikzpicture}

```

representation of setting of @eq-qte-unconf. Note that the arrow is going from $x$ to $Y^x_i$, not from $X_i$ to $Y^x_i$. Likewise, the arrow is going from $W_i$ to $X_i$, not $x$.

:::


## Parameters of Interest

The setting of @eq-qte-unconf is richer than that of @eq-qte-rct. It allows us to consider all of the unconditional and conditional QTEs and DTEs described in section [-@sec-qte-intro].  

Specifically, in this section we focus on distributional treatment effects, while quantile treatment effects are discussed in the next section.
In order of identification, our parameteres of interest are:


1.  DTE conditional on $W_i=w$ (@eq-qte-dfn-cond):
$$
\begin{align} 
DTE(x_1, x_2, y|w) & = F_{Y^{x_2}|W}(y|w) - F_{Y^{x_1}|W}(y|w).
\end{align}
$$
2. Unconditional  DTE (@eq-qte-dfn-uncond):
$$
\begin{aligned} 
DTE(x_1, x_2, y) & = F_{Y^{x_2}}(y) - F_{Y^{x_1}}(y). 
\end{aligned}
$$
3. DTE conditional on $X_i=x_3$ (@eq-qte-dfn-cond-treat):
$$
\begin{align} 
	DTE(x_1, x_2, y|x_3) & = F_{Y^{x_2}|X}(y|x_3) - F_{Y^{x_1}|X}(y|x_3). 
\end{align}
$$
 


## CDF Conditional on $W_i$


We begin with the simplest identification argument --- that of the conditional distribution of $Y^x_i$ given $W_i=w$.
 
By definition, we can write the target CDF as
$$
F_{Y^x|W}(y|w) = \E[\I\curl{Y^x_i \leq y}|W_i=w].
$$

As before, the overall goal is to connect the above expression to the the realized outcome $Y_i$. To do so, we first use the unconfoundedness assumption ([-@eq-qte-unconf]) to condition on $X_i=x$:
$$
\begin{aligned}
& \E[\I\curl{Y^x_i \leq y}|W_i=w] \\
& =  \E[\I\curl{Y^x_i \leq y}|X_i=x, W_i=w].
\end{aligned}
$$
Since $Y^x_i$ and $X_i$ are conditionally independent given $W_i$, we do not change the value of the expectation by conditioning on any value of $X_i$, including $x$.

Next, we use that $Y_i=Y^x_i$ if $X_i=x$ to replace $Y^x_i$ with $Y_i$:
$$
\begin{align} 
	&   \E\left[\I\curl{Y^x_i\leq y}|X_i=d, W_i=w \right]\\
	& = \E\left[ \I\curl{Y_i\leq y}|X_i=d, W_i=w   \right]\\
	& \equiv F_{Y|X, W}(y|x, w),
\end{align}
$$ 
where $F_{Y|X, W}(y|x, w)$ is the conditional CDF of the realized outcome $Y_i$ given $X_i=x$ and $W_i=w$.

Combining the above chain of equalities, we conclude that
$$
F_{Y^x|W}(y|w) = F_{Y|X, W}(y|x, w).
$$
In words, the CDF of interest is equal to a particular conditional distribution of the observed outcome $Y_i$.

## Unconditional CDF

We now turn to the unconditional CDF of $Y^x_i$:
$$
F_{Y^x}(y)   = \E\left[ \I\curl{Y^x_i \leq y} \right].
$$
As before, we would like to replace $Y^x_i$ with the observed outcome $Y_i$. However, this time we cannot naively insert conditioning on $\curl{X_i=x}$ without changing the expectation. 

To solution is to again use the condition ([-@eq-qte-unconf]) by first conditioning with respect to $W_i$ using the defining property of conditional expectation:
$$
\begin{aligned}
 & \E\left[ \I\curl{Y^x_i \leq y} \right] \\
 & = \E\left[ \E\left[\I\curl{Y^x_i \leq y} | W_i  \right]\right].
\end{aligned}
$$

We can now use the unconfoundedness assumption ([-@eq-qte-unconf]) to condition on $X_i$ inside the conditional expectation. This conditioning does not affect the expectation (more precisely, the distribution of the conditional expectation in question):

$$
\begin{aligned}
 & \E\left[ \E\left[\I\curl{Y^x_i \leq y} | W_i  \right]\right]\\
 & = \E\left[ \E\left[\I\curl{Y^x_i \leq y} | X_i=x, W_i  \right]\right].
\end{aligned}
$$

From this point out, we can replace $Y^x_i$ with $Y_i$ under the conditional expectation to finish the argument. In order to obtain a more explicit representation, let $F_W(\cdot)$ be the marginal CDF of $W_i$. Then:

$$
\begin{aligned} 
	&   \E\left[ \E\left[\I\curl{Y^x_i \leq y} | X_i=x, W_i  \right]\right] \\
	& = \E\left[ \E\left[ \I\curl{Y_i\leq y}| X_i=x, W_i \right]  \right]\\
	& = \E\left[  F_{Y|X, W}(y|x, W_i) \right]\\
	& = \int F_{Y|X, W}(y|x, w)F_W(dw).
\end{aligned} 
$$

Combining the above equalities, we obtain the identifying expression:
$$
F_{Y^x}(y) = \int F_{Y|X, W}(y|x, w)F_W(dw).
$$
In words, the marginal CDF of $Y^x_i$ is equal to a reweighted conditional CDF of the observed outcome, where the weights are calculated over $w$ and correspond to the marginal distribution of $W_i$. Observe that the object in the last line is not equal to $F_{Y|X}(y|x)$. 




## CDF Conditional on $X_i$

Finally, we consider the CDF $F_{Y^x|X}(y|x_3)$  â€” the distribution of the potential outcome under $x$ in the group which received a potentially different treatment $x_3$. 

Extending the above logic, we can also identify the conditional CDF $F_{Y^x|X}(y|x_3)$ through the following argument:
$$
\begin{aligned}
	F_{Y^x|X}(y|x_3)  & =  \E\left[ \I\curl{Y^x_i \leq y}|X_i=x_3 \right] \\
    & = \E\left[ \E\left[ \I\curl{Y^x_i \leq y}|X_i=x_3, W_i \right]|X_i=x_3\right]\\
	& =  \E\left[ \E\left[ \I\curl{Y^x_i \leq y}|X_i=x, W_i \right]|X_i=x_3\right]\\
	& = \E\left[ \E\left[ \I\curl{Y_i\leq y}|D_i=x, W_i \right]|X_i=x_3\right]\\
	& = \E\left[ F_{Y|X, W}(y|x, W_i)|X_i=x_3 \right]\\
	& = \int F_{Y|X, W}(y|x, w) F_{W|X}(dw|x_3).  
\end{aligned}
$$
In the last line we make an implicit assumption  that  the support of $X_i$ conditional on $D_i=k$ is included in the support of $X_i$ conditional on $D_i=d$. Without such an assumption the integral may not be well-defined. 

When $k=d$, the above argument simply reduces to 
$$
	 F_{Y^d|D}(y|k) = F_{Y|D}(y|d).
$$

---

#### Next Section {.unnumbered}

In the next section, we discuss identification of quantile treatment effects in the setting of @eq-qte-unconf.