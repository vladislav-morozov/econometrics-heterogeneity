--- 
description: "Explore nonparametric models with unobserved heterogeneity. Identification under  minimal functional form assumptions. (Lecture Notes)"

open-graph:
    description: "Explore nonparametric models with unobserved heterogeneity. Identification under minimal functional form assumptions. (Lecture Notes)"
---


# Introduction to Nonparametric Models with Unobserved Heterogeneity {#sec-nonparametric-intro}

::: {.callout-note appearance="simple" icon=false}

## Summary and Learning Outcomes

This section introduces nonparametric models with unobserved heterogeneity and lays out the structure and goals for this block. 

By the end of this section, you should

- Explain limitations of linear models.   
- Write down generic nonparametric models with unobserved heterogeneity.
- Understand identification challenges and the assumptions commonly used to address them.

:::


## Towards Nonparametric Models

### Motivation

We began these notes by studying linear models with heterogeneous coefficients ([-@eq-lecture_model]), a familiar and flexible starting point. As discussed in section [-@sec-linear-intro], such models are widely used and arise naturally in empirical work.
 
But linearity is not innocent. Except for binary-only covariates, the assumption often lacks theoretical support and may be at odds with the data. Many economic settings suggest richer structures: preferences with satiation, production with non-constant returns to scale, or outcomes bounded by construction. Furthermore, differences between individuals may not be compressible into a finite-dimensional vector of heterogeneous coefficients. 
In such cases, linear models may be severely misspecified and lead to incorrect conclusions. 
 
This motivates a shift. In this block, we move beyond linearity and consider nonparametric models with unobserved heterogeneity — a class that allows for far greater flexibility in how outcomes respond to both observed and unobserved variation. These models present new challenges but also offer a more powerful framework for accounting for unobserved differences. 

### Nonparametric Models


Nonparametric models address functional form concerns directly. Rather than imposing a specific shape on the relationship between $y$ and  the covariates $\bx$, we assume only that this relationship is governed by an unknown function $\phi$ of observed and unobserved variables. This leads to the following general setup:


- In cross-sectional settings:
$$
	y_i = \phi(\bx_i, \alpha_i), \quad {}_{i=1,\dots, N},
$$ {#eq-nonparametric-generic-cross-section}
where $\bx_i$ includes the observed variables and $\alpha_i$ includes the unobserved components.

- In panel data settings
$$
	y_{it} = \phi(\bx_{it}, \alpha_i, u_{it}), \quad {}_{i=1,\dots, N}^{t= 1, \dots, T},
$$ {#eq-nonparametric-generic-panel}
where both $\alpha_i$ and $u_{it}$ are not observed. 

Models ([-@eq-nonparametric-generic-cross-section]) and ([-@eq-nonparametric-generic-panel]) parallel and generalize models ([-@eq-cross_sectional_hetero]) and ([-@eq-panel_hetero]).

In both cases the nature of $(\alpha_i, u_{it})$ is not restricted a priori. These unobserved components may include both finite-dimensional vectors (such as unobserved variables or coefficients) and infinite-dimensional objects (such as utility functions). In such a fully unrestricted setting, we can equivalently represent ([-@eq-nonparametric-generic-cross-section]) and ([-@eq-nonparametric-generic-panel]) as
$$
	y_i = \phi_i(x_i), \quad \quad  y_{it} = \phi_{it}(x_{it}),
$$
respectively. 


### Object of Interest


As in the linear case, possible objects of interest include:

-  The full structural function $\phi(\cdot, \cdot)$ or $\phi(\cdot, \cdot, \cdot)$. 	This function fully describes the relationship between $y$ and $\bx$ for all individuals. 	This corresponds to the problem of identifying individual treatment effects.
- Some distributional features of "treatment effects" — changes in outcomes due to variation in $x_{it}$, conditional on unobserved heterogeneity. In the context of model ([-@eq-nonparametric-generic-panel]), these effects are given by
$$
	\begin{aligned}
		&	\phi(\bx_2, \alpha_i, u_{it}) - \phi(\bx_1, \alpha_i, u_{it}),\\
		&	\partial_{\bx} \phi(\bx_0, \alpha_i, u_{it}),
	\end{aligned}
$$    {#eq-nonparametric-effects}
where $\bx_0, \bx_1, \bx_2$ are some possible values for $\bx_{it}$, and the marginal effect is considered if $\phi$ is suitably differentiable in $\bx$.  	The distributional feature of interest may include average effects,   variances, higher-order moments, or the full distribution.

### Common Issue

Unfortunately, models ([-@eq-nonparametric-generic-cross-section]) and ([-@eq-nonparametric-generic-panel]) require further assumptions to be useful, as discussed in section [-@sec-introduction]. Without assumptions, we cannot hope to identify counterfactual objects of interest, not even average effects. 
 
::: {.callout-note appearance="simple" icon=false}

In a strict sense, one may point out that   ([-@eq-nonparametric-generic-cross-section]) and ([-@eq-nonparametric-generic-panel]) are not even models in the sense of offering testable predictions or supporting counterfactual analysis. ([-@eq-nonparametric-generic-cross-section]) and ([-@eq-nonparametric-generic-panel]) are just statements that $\bx$ and $y$ are related through some function that may differ with $i$ and $t$. Such a statement is vacuously true. For example, without further assumptions one may take $\phi(x, a) = a$ and $\alpha_i =y_i$ in  ([-@eq-nonparametric-generic-cross-section]). 

:::

Typically, such assumptions fall into two categories:

1. Assumptions on the joint distribution of the observed and the unobserved components, including on the nature of $(\alpha_i, u_{it})$. 
2. Assumptions on how unobserved components enter the equation.

## Models of This Block

To make progress, we focus on two general but tractable versions of the general nonparametric panel model ([-@eq-nonparametric-generic-panel]) in these notes. In both cases, we will assume that the outcome $y$ is continuous and that $T=2$.

 
### First Model {.unnumbered}

We will begin with the following model:
$$
	y_{it} = \phi(x_{it}, \alpha_i, u_{it}), \quad {}_{i=1, \dots, N}^{t=1, 2}.
$$ {#eq-nonparametric-model-full-nonsep}
where for simplicity we assume that $x_{it}$ is scalar. The variable $x_{it}$ is assumed to be continuously distributed, and $\phi$  is continuous in $x_{it}$ for all values of $(\alpha_i, u_{it})$.

We  consider a version  of ([-@eq-nonparametric-model-full-nonsep]) that is very general in terms of unobserved variables $(\alpha_{i}, u_{it})$. In particular, we do not restrict

- The dimension and the form   of $\alpha_i$ and $u_{it}$;
- How the outcome depends on $(\alpha_{it}, u_{it})$;
- The dependence structure between $(\alpha_i, u_{it})$ and $x_{it}$.

At the same time, we impose an assumption of stationarity on $u_{it}$.  Its distribution is stable over time conditional on observed and unobserved covariates, allowing us to isolate changes in $y_{it}$ attributable to variation in $x_{it}$.


### Second Model {.unnumbered}

After reaching the (probable) limits of identification with ([-@eq-nonparametric-model-full-nonsep]),  we will consider a different flavor of model ([-@eq-nonparametric-generic-panel]), where the time-varying unobserved component $u_{it}$ is scalar and affects the outcome $y_{it}$ additively:
$$
y_{it} = \phi(x_{it}, \alpha_i) + u_{it}, \quad {}_{i=1, \dots, N}^{t=1, 2}
$$ {#eq-nonparametric-model-u-sep}
In contrast to model ([-@eq-nonparametric-model-full-nonsep]), we do not assume that $u_{it}$ is stationary. Models  ([-@eq-nonparametric-model-full-nonsep]) and ([-@eq-nonparametric-model-u-sep]) are hence non-nested. We continue to allow $\alpha_i$ to have unrestricted dimensionality and structure. It may also have a complex dependence structure with $x_{it}$.


## Plan for This Block

In this block, we will focus on models ([-@eq-nonparametric-model-full-nonsep])-([-@eq-nonparametric-model-u-sep]) and consider identification of some distributional features of treatment effects ([-@eq-nonparametric-effects]). Specifically,

1. **Average** treatment and marginal **effects** for model ([-@eq-nonparametric-model-full-nonsep]):
   - Show that identifying average effects is more complicated than  considering averages of the outcome directly.
   - Discuss heterogeneity bias, another form of confounding.
   - Show how stationarity assumptions on $u_{it}$ allow us to identify the average effects for a population of stayers — units with $x_{i1}=x_{i2}$ — without any further assumptions.
   - Consider two generalizations of the identification result: beyond the population of stayers and allowing some non-stationarity in the structural function.
2. **Variance** of treatment and marginal effects in model ([-@eq-nonparametric-model-u-sep]): identify the variance of effects  ([-@eq-nonparametric-effects]) by requiring that $u_{it}$ cannot depend on future values of $\bx_{it}$

 
In the next block, we will also revisit model ([-@eq-nonparametric-model-full-nonsep]) through the lens of quantile regression.

## A Brief Classification of Nonparametric Models

In these notes we primarily focus on the general and powerful models ([-@eq-nonparametric-model-full-nonsep])-([-@eq-nonparametric-model-u-sep]). However, much work has gone into analyzing other special instances of ([-@eq-nonparametric-generic-cross-section]) and ([-@eq-nonparametric-generic-panel]). Before moving on to identification of average effects, we offer a brief taxonomy of nonparametric models with unobserved heterogeneity with some essential references. We organize the literature by the types of assumptions made:


- *How unobserved heterogeneity enters in the system*:
  - Full non-separable models  [@Altonji2005; @Hoderlein2007; @Hoderlein2007; @Chernozhukov2015].
  -  Partially additive separable panel models: [@Chen2003; @Evdokimov2012; @Blundell2012b; @Morozov2023jmp].
    - Fully separable, additively [@Henderson2008NonparametricEstimationTesting; @Boneva2015SemiparametricModelHeterogeneous; @Lee2015PanelNonparametricRegression;@Henderson2024NonparametricModelsFixed] or multiplicatively [@Beckert2008HeterogeneityNonParametricAnalysis].
- *What assumptions are imposed on the form of unobserved components*: restrictions on dimension such as scalarity [@Matzkin2003; @Altonji2005; @Imbens2009]  or no restrictions [@Hoderlein2007; @Hoderlein2007; @Chernozhukov2015]]
- *What assumptions are imposed on dependence structure between observed and unobserved components*: full or partial independence restrictions [@Hoderlein2007; @Imbens2009] vs. no independence restrictions [@Hoderlein2012; @Chernozhukov2015].
- *The nature of the outcome variable*: continuous-outcome models [@Chernozhukov2015] or discrete-outcome models [@Manski1987; @Chesher2017; @Chesher2020].

---

#### Next Section {.unnumbered}

TBA.