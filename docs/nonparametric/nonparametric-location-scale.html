<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Learn to identify average effects in a nonparametric continuous difference-in-differences model with infinite-dimensional heterogeneity (Lecture Notes)">

<title>15&nbsp; Relaxing Stationarity with Nonparametric Time Effects – Econometrics with Unobserved Heterogeneity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references/references.html" rel="next">
<link href="../nonparametric/nonparametric-average-estimation.html" rel="prev">
<link href="../themes/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5d2b45bed95172e221bc55a94b858b1a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d922cade42bc4f32e00ea3a44fd4d3b7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
 

<!-- This is what works with Quarto and MathJax 3+ -->

<script>

  MathJax = {

    tex: {

      tags: 'ams',  // should be 'ams', 'none', or 'all'

      macros: {

        vect: ["\\mathbf{#1}", 1],

        mat: ["\\mathbf{#1}", 1], 



        bA: "\\boldsymbol{A}",

        bB: "\\boldsymbol{B}",

        bC: "\\boldsymbol{C}",

        bD: "\\boldsymbol{D}",

        bE: "\\boldsymbol{E}",

        bF: "\\boldsymbol{F}",

        bG: "\\boldsymbol{G}",

        bH: "\\boldsymbol{H}",

        bI: "\\boldsymbol{I}",

        bJ: "\\boldsymbol{J}",

        bK: "\\boldsymbol{K}",

        bL: "\\boldsymbol{L}",

        bM: "\\boldsymbol{M}",

        bN: "\\boldsymbol{N}",

        bP: "\\boldsymbol{P}",

        bQ: "\\boldsymbol{Q}",

        bR: "\\boldsymbol{R}",

        bS: "\\boldsymbol{S}",

        bT: "\\boldsymbol{T}",

        bU: "\\boldsymbol{U}",

        bV: "\\boldsymbol{V}",

        bW: "\\boldsymbol{W}",

        bX: "\\boldsymbol{X}",

        bY: "\\boldsymbol{Y}",

        bZ: "\\boldsymbol{Z}",

        ba: "\\boldsymbol{a}",

        bb: "\\boldsymbol{b}",

        bc: "\\boldsymbol{c}",

        bd: "\\boldsymbol{d}",

        be: "\\boldsymbol{e}",

        bg: "\\boldsymbol{g}",

        bh: "\\boldsymbol{h}",

        bi: "\\boldsymbol{\\imath}",

        bm: "\\boldsymbol{m}",

        bp: "\\boldsymbol{p}",

        bq: "\\boldsymbol{q}",

        br: "\\boldsymbol{r}",

        bs: "\\boldsymbol{s}",

        bt: "\\boldsymbol{t}",

        bu: "\\boldsymbol{u}",

        bv: "\\boldsymbol{v}",

        bw: "\\boldsymbol{w}",

        bx: "\\boldsymbol{x}",

        by: "\\boldsymbol{y}",

        bz: "\\boldsymbol{z}",



        Acal: "\\mathcal{A}",

        Bcal: "\\mathcal{B}",

        Ccal: "\\mathcal{C}",

        Dcal: "\\mathcal{D}",

        Ecal: "\\mathcal{E}",

        Fcal: "\\mathcal{F}",

        Gcal: "\\mathcal{G}",

        Hcal: "\\mathcal{H}",

        Ical: "\\mathcal{I}",

        Jcal: "\\mathcal{J}",

        Kcal: "\\mathcal{K}",

        Lcal: "\\mathcal{L}",

        Mcal: "\\mathcal{M}",

        Ncal: "\\mathcal{N}",

        Ocal: "\\mathcal{O}",

        Pcal: "\\mathcal{P}",

        Qcal: "\\mathcal{Q}",

        Rcal: "\\mathcal{R}",

        Scal: "\\mathcal{S}",

        Tcal: "\\mathcal{T}",

        Ucal: "\\mathcal{U}",

        Vcal: "\\mathcal{V}",

        Wcal: "\\mathcal{W}",

        Xcal: "\\mathcal{X}",

        Ycal: "\\mathcal{Y}",

        Zcal: "\\mathcal{Z}",



        A: "\\mathbb{A}",

        B: "\\mathbb{B}",

        C: "\\mathbb{C}",

        D: "\\mathbb{D}",

        E: "\\mathbb{E}",

        F: "\\mathbb{F}",

        G: "\\mathbb{G}",

        H: "\\mathbb{H}",

        I: "\\mathbb{I}",

        J: "\\mathbb{J}",

        K: "\\mathbb{K}",

        L: "\\mathbb{L}",

        M: "\\mathbb{M}",

        N: "\\mathbb{N}",

        O: "\\mathbb{O}",

        P: "\\mathbb{P}",

        Q: "\\mathbb{Q}",

        R: "\\mathbb{R}",

        S: "\\mathbb{S}",

        T: "\\mathbb{T}",

        U: "\\mathbb{U}",

        V: "\\mathbb{V}",

        W: "\\mathbb{W}",

        X: "\\mathbb{X}",

        Y: "\\mathbb{Y}",

        Z: "\\mathbb{Z}",



        bAlpha: "\\boldsymbol{\\Alpha}",

        bBeta: "\\boldsymbol{\\beta}",

        bDelta: "\\boldsymbol{\\delta}",

        bEta: "\\boldsymbol{\\eta}",

        bGamma: "\\boldsymbol{\\Gamma}",

        bLambda: "\\boldsymbol{\\Lambda}",

        bOmega: "\\boldsymbol{\\Omega}",

        bPhi: "\\boldsymbol{\\Phi}",

        bPi: "\\boldsymbol{\\Pi}",

        bPsi: "\\boldsymbol{\\Psi}",

        bSigma: "\\boldsymbol{\\Sigma}",

        bTau: "\\boldsymbol{\\tau}",

        bXi: "\\boldsymbol{\\Xi}",

        bbeta: "\\boldsymbol{\\beta}",

        bdelta: "\\boldsymbol{\\delta}",

        blambda: "\\boldsymbol{\\lambda}",

        bmu: "\\boldsymbol{\\mu}",

        bphi: "\\boldsymbol{\\phi}",

        bpi: "\\boldsymbol{\\pi}",

        bpsi: "\\boldsymbol{\\psi}",

        brho: "\\boldsymbol{\\rho}",

        bsigma: "\\boldsymbol{\\sigma}",

        btau: "\\boldsymbol{\\tau}",

        bxi: "\\boldsymbol{\\xi}",

        bEta: "\\boldsymbol{\\eta}",

        bPhi: "\\boldsymbol{\\Phi}",

        bPi: "\\boldsymbol{\\Pi}",

        bPsi: "\\boldsymbol{\\Psi}",

        bXi: "\\boldsymbol{\\Xi}",

        blambda: "\\boldsymbol{\\lambda}",

        bmu: "\\boldsymbol{\\mu}",

        bphi: "\\boldsymbol{\\phi}",

        bpi: "\\boldsymbol{\\pi}",

        bpsi: "\\boldsymbol{\\psi}",

        brho: "\\boldsymbol{\\rho}",

        bsigma: "\\boldsymbol{\\sigma}",

                   

        curl: ["\\left\\lbrace#1\\right\\rbrace", 1],

        floor: ["\\left\\lfloor#1\\right\\rfloor", 1],

        ceil: ["\\left\\lceil#1\\right\\rceil", 1],

        abs: ["\\left\\lvert#1\\right\\rvert", 1],

        norm: ["\\left\\lVert#1\\right\\rVert", 1],



        independent: "\\mathrel{\\perp\\!\\!\\perp}",



        var: "\\mathrm{var}",

        diag: "\\mathrm{diag}",

        rank: "\\mathrm{rank}",

        vecc: "\\mathrm{vec}",

      }

    }

  };

</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="15&nbsp; Relaxing Stationarity with Nonparametric Time Effects – Econometrics with Unobserved Heterogeneity">
<meta property="og:description" content="Learn to identify average effects in a nonparametric continuous difference-in-differences model with infinite-dimensional heterogeneity (Lecture Notes)">
<meta property="og:site_name" content="Econometrics with Unobserved Heterogeneity">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../nonparametric/nonparametric-introduction.html">Nonparametrics and Heterogeneity</a></li><li class="breadcrumb-item"><a href="../nonparametric/nonparametric-location-scale.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Relaxing Stationarity with Nonparametric Time Effects</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Econometrics with Unobserved Heterogeneity</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://vladislav-morozov.github.io/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-person-arms-up"></i></a>
    <a href="https://www.linkedin.com/in/vladislavvmorozov/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/vladislav-morozov/econometrics-heterogeneity/tree/main/src/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Information</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction: Causal Inference with Unobserved Heterogeneity</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Intro: Linear Models with Heterogeneous Coefficients</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-within-estimator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Within (Fixed Effects) Estimator and Heterogeneous Coefficients</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-dynamic-panel-iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interlude: Standard Dynamic Panel Estimators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-dynamic-panel-heterogeneity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Heterogeneous Coefficient Dynamic Panels and Instrumental Variable Estimators</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-mean-group.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mean Group: Robust Estimator for Average Coefficients</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-coefficient-variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Variance of Heterogeneous Coefficients</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-chf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Interlude: Characteristic Functions and Deconvolution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Distribution of Heterogeneous Coefficients</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linear/linear-conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Conclusion: Linear Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Nonparametrics and Heterogeneity</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonparametric/nonparametric-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduction to Nonparametric Models with Unobserved Heterogeneity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonparametric/nonparametric-heterogeneity-bias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Average Effects and Heterogeneity Bias</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonparametric/nonparametric-average-identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Nonparametric Identification of Average Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonparametric/nonparametric-average-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Nonparametric Estimation of Average Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonparametric/nonparametric-location-scale.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Relaxing Stationarity with Nonparametric Time Effects</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Quantile and Distributional Methods</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#a-more-general-model" id="toc-a-more-general-model" class="nav-link active" data-scroll-target="#a-more-general-model"><span class="header-section-number">15.1</span> A More General Model</a>
  <ul class="collapse">
  <li><a href="#the-drawbacks-of-stationarity" id="toc-the-drawbacks-of-stationarity" class="nav-link" data-scroll-target="#the-drawbacks-of-stationarity"><span class="header-section-number">15.1.1</span> The Drawbacks of Stationarity</a></li>
  <li><a href="#including-location-scale-time-effects" id="toc-including-location-scale-time-effects" class="nav-link" data-scroll-target="#including-location-scale-time-effects"><span class="header-section-number">15.1.2</span> Including Location-Scale Time Effects</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">15.1.3</span> Discussion</a></li>
  </ul></li>
  <li><a href="#identification" id="toc-identification" class="nav-link" data-scroll-target="#identification"><span class="header-section-number">15.2</span> Identification</a>
  <ul class="collapse">
  <li><a href="#scale-effect" id="toc-scale-effect" class="nav-link" data-scroll-target="#scale-effect"><span class="header-section-number">15.2.1</span> Scale Effect</a></li>
  <li><a href="#location-effect-and-average-of-phi" id="toc-location-effect-and-average-of-phi" class="nav-link" data-scroll-target="#location-effect-and-average-of-phi"><span class="header-section-number">15.2.2</span> Location Effect and Average of <span class="math inline">\(\phi\)</span></a></li>
  <li><a href="#average-derivative-of-phi" id="toc-average-derivative-of-phi" class="nav-link" data-scroll-target="#average-derivative-of-phi"><span class="header-section-number">15.2.3</span> Average Derivative of <span class="math inline">\(\phi\)</span></a></li>
  </ul></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">15.3</span> Estimation</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/vladislav-morozov/econometrics-heterogeneity/edit/main/src/nonparametric/nonparametric-location-scale.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/vladislav-morozov/econometrics-heterogeneity/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../nonparametric/nonparametric-introduction.html">Nonparametrics and Heterogeneity</a></li><li class="breadcrumb-item"><a href="../nonparametric/nonparametric-location-scale.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Relaxing Stationarity with Nonparametric Time Effects</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-nonparametric-loc-scale" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Relaxing Stationarity with Nonparametric Time Effects</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary and Learning Outcomes
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section shows how to extend identification of marginal effects to a model with nonparametric location-scale time effects.</p>
<p>By the end of this section, you should be able to:</p>
<ul>
<li>Identify the average marginal effects for stayers under a model with location-scale effects and potentially infinite-dimensional heterogeneity.<br>
</li>
<li>Propose estimators for the average marginal effects.</li>
<li>Draw parallels between the models of this block and event study/difference-in-differences approaches.</li>
</ul>
</div>
</div>
<hr>
<section id="a-more-general-model" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="a-more-general-model"><span class="header-section-number">15.1</span> A More General Model</h2>
<section id="the-drawbacks-of-stationarity" class="level3" data-number="15.1.1">
<h3 data-number="15.1.1" class="anchored" data-anchor-id="the-drawbacks-of-stationarity"><span class="header-section-number">15.1.1</span> The Drawbacks of Stationarity</h3>
<p>The stationarity assumption (<a href="nonparametric-average-identification.html#eq-nonparam-stationarity-u" class="quarto-xref"><span>13.3</span></a>) is crucial to the identification argument of section (<a href="nonparametric-average-identification.html" class="quarto-xref"><span>13</span></a>). It allows us to connect the average change in the realized outcomes <span class="math inline">\(Y_{it}\)</span> to finite differences of the structural function <span class="math inline">\(\phi(\cdot, \cdot, \cdot)\)</span>. In turn, this connection leads to our key identification result for average marginal effects: <span class="math display">\[
\begin{aligned}
    &amp; \E[\partial^x Y_{it}^{x}|X_{i1} = X_{i2} = x]\\
    &amp; = \E[\partial_x\phi (x, A_i, U_{it})|X_{i1}=X_{i2}=x] \\
    &amp; = \partial_{x_2} \E\left[Y_{i2}- Y_{i1}|X_{i1}=x_1, X_{i2} = x_2 \right]\Big|_{(x_1, x_2)=(x, x)}.
\end{aligned}
\]</span></p>
<p>While useful for identification, assumption (<a href="nonparametric-average-identification.html#eq-nonparam-stationarity-u" class="quarto-xref"><span>13.3</span></a>) imposes that the function <span class="math inline">\(\phi(\cdot, \cdot, \cdot)\)</span> <em>cannot</em> change across periods. Such time invariance may be reasonable if consecutive observations are not separated by long periods of time. In contrast, it may be untenable if the interval between observations is large or there are meaningful changes in the overall “context” in which the units operate.</p>
</section>
<section id="including-location-scale-time-effects" class="level3" data-number="15.1.2">
<h3 data-number="15.1.2" class="anchored" data-anchor-id="including-location-scale-time-effects"><span class="header-section-number">15.1.2</span> Including Location-Scale Time Effects</h3>
<p>However, it is possible to accommodate some changes over time while preserving our identification results. In particular, it is possible to accommodate flexible location-scale effects that depend on the observables nonparametrically.</p>
<p>Specifically, we now consider the following extension of the model (<a href="nonparametric-introduction.html#eq-nonparametric-model-full-nonsep" class="quarto-xref"><span>11.4</span></a>), discussed by <span class="citation" data-cites="Chernozhukov2015">Chernozhukov et al. (<a href="../references/references.html#ref-Chernozhukov2015" role="doc-biblioref">2015</a>)</span>: <span id="eq-nonparametric-loc-scale-model"><span class="math display">\[
\begin{aligned}
    Y_{i1}^{x_1}  &amp;= \phi(x_1, A_i, U_{it}),\\
    Y_{i2}^{x_2} &amp; = \mu(x_2) + \sigma(x_2) \phi(x_2, A_i, U_{i2}).
\end{aligned}
\tag{15.1}\]</span></span> The functions <span class="math inline">\(\mu(\cdot)\)</span> and <span class="math inline">\(\sigma(\cdot)\)</span> may be viewed as flexible nonparametric <em>location-scale</em> time effects. We assume throughout that <span class="math inline">\(\sigma(\cdot)\neq 0\)</span>.</p>
<p>Although we allow the function <span class="math inline">\(\phi\)</span> to change, we retain the conditional stationarity assumption (<a href="nonparametric-average-identification.html#eq-nonparam-stationarity-u" class="quarto-xref"><span>13.3</span></a>): <span class="math display">\[
U_{i1}|(X_{i1}, X_{i2}, A_i) \overset{d}{=} U_{i2}|(X_{i1}, X_{i2}, A_i).
\]</span></p>
<p>The key objects of interest are the average marginal effects of <span class="math inline">\(x\)</span> for stayers in periods <span class="math inline">\(t=1\)</span>: <span id="eq-nonparametric-loc-scale-t1"><span class="math display">\[
\begin{aligned}
  \E[\partial_x Y_{i1}^x|X_{i1}=X_{i2} =x] &amp; = \E\left[ \partial_x \phi(x, A_{i}, U_{it}) |X_{i1}=X_{i2} =x\right],
\end{aligned} \tag{15.2}\]</span></span> and <span class="math inline">\(t=2\)</span>: <span id="eq-nonparametric-loc-scale-t2"><span class="math display">\[
\begin{aligned}
&amp; \E[\partial_x Y_{i2}^x|X_{i1}=X_{i2} =x]\\
  &amp; = \E\left[ \partial_x \left(\mu(x) + \sigma(x)\phi(x, A_{i}, U_{it})  \right)|X_{i1}=X_{i2} =x\right]
\end{aligned}
\tag{15.3}\]</span></span> Observe that there is now time variation in the average effects, unlike under model (<a href="nonparametric-average-identification.html#eq-nonparam-stationarity-u" class="quarto-xref"><span>13.3</span></a>).</p>
</section>
<section id="discussion" class="level3" data-number="15.1.3">
<h3 data-number="15.1.3" class="anchored" data-anchor-id="discussion"><span class="header-section-number">15.1.3</span> Discussion</h3>
<p>Model (<a href="#eq-nonparametric-loc-scale-model" class="quarto-xref"><span>15.1</span></a>) preserves the two attractive features of the simpler model (<a href="nonparametric-introduction.html#eq-nonparametric-model-full-nonsep" class="quarto-xref"><span>11.4</span></a>):</p>
<ol type="1">
<li><span class="math inline">\((A_i, U_{it})\)</span> can take any form, have any dimension, and affect the potential outcomes arbitrarily.</li>
<li>There are no restrictions on the dependence between the treatment <span class="math inline">\(X_{it}\)</span> and potential outcomes.</li>
</ol>
<p>Intuitively, the connection between models (<a href="nonparametric-introduction.html#eq-nonparametric-model-full-nonsep" class="quarto-xref"><span>11.4</span></a>) and (<a href="#eq-nonparametric-loc-scale-model" class="quarto-xref"><span>15.1</span></a>) mirrors familiar binary-treatment settings. The time-invariant model (<a href="nonparametric-introduction.html#eq-nonparametric-model-full-nonsep" class="quarto-xref"><span>11.4</span></a>) corresponds to a nonparametric event-study design with a continuous treatment (see chapter 17 of <span class="citation" data-cites="Huntington-Klein2025EffectIntroductionResearch">Huntington-Klein (<a href="../references/references.html#ref-Huntington-Klein2025EffectIntroductionResearch" role="doc-biblioref">2025</a>)</span> regarding event studies with no trends in the outcome). The location-scale extension (<a href="#eq-nonparametric-loc-scale-model" class="quarto-xref"><span>15.1</span></a>), by contrast, generalizes this to a nonparametric difference-in-differences framework, accommodating nonparametric trends in the outcomes.</p>
</section>
</section>
<section id="identification" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="identification"><span class="header-section-number">15.2</span> Identification</h2>
<p>We now turn to identification of the average marginal effects (<a href="#eq-nonparametric-loc-scale-t1" class="quarto-xref"><span>15.2</span></a>) and (<a href="#eq-nonparametric-loc-scale-t2" class="quarto-xref"><span>15.3</span></a>). Identification proceeds in three steps:</p>
<ol type="1">
<li>Identifying the scale function <span class="math inline">\(\sigma(\cdot)\)</span>.</li>
<li>Identifying the location function <span class="math inline">\(\mu(\cdot)\)</span>.</li>
<li>Identifying the average value <span class="math inline">\(\E[\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x]\)</span> of <span class="math inline">\(\phi\)</span> and the average value of its derivative <span class="math inline">\(\E[\partial_x \phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x]\)</span>.</li>
</ol>
<p>Together, these components are sufficient to identify both (<a href="#eq-nonparametric-loc-scale-t1" class="quarto-xref"><span>15.2</span></a>) and (<a href="#eq-nonparametric-loc-scale-t2" class="quarto-xref"><span>15.3</span></a>), since the second period effect can be represented as <span class="math display">\[
\begin{aligned}
&amp; \E\left[ \partial_x \left(\mu(x) + \sigma(x)\phi(x, A_{i}, U_{it}) \right)|X_{i1}=X_{i2} =x\right] \\
&amp; = \partial_x \mu(x) \\
&amp; \quad + \sigma(x) \E[\partial_x \phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x] \\
&amp; \quad + \left(\partial_x \sigma(x)\right) \E[\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x]
\end{aligned}
\]</span></p>
<section id="scale-effect" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="scale-effect"><span class="header-section-number">15.2.1</span> Scale Effect</h3>
<p>We begin by identifying the scale function <span class="math inline">\(\sigma(\cdot)\)</span>. The scale is directly connect to the variance of the second period realized outcome for the subpopulation of stayers as <span class="math display">\[
\begin{aligned}
    &amp; \var(Y_{i2}|X_{i1}=X_{i2}=x) \\
    &amp; = \sigma^2(x)\var(\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x).
\end{aligned}
\]</span> As before, the notation <span class="math inline">\(U_{it}\)</span> under <span class="math inline">\(\phi\)</span> emphasizes stationarity of <span class="math inline">\(U_{it}\)</span>.</p>
<p>At the same time, the conditional variance of <span class="math inline">\(\phi(x, A_i, U_{it})\)</span> for stayers is directly obtained from the variance of the first period realized outcome: <span class="math display">\[
\begin{aligned}
    &amp; \var\left(Y_{i1}|X_{i1}=X_{i2}=x \right) \\
    &amp; = \var(\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x).
\end{aligned}
\]</span></p>
<p>Combining the two expression yields an explicit formula for the scale effect, provided <span class="math inline">\(\var\left(Y_{i1}|X_{i1}=X_{i2}=x \right)\neq 0\)</span>: <span class="math display">\[
    \sigma^2(x) = \dfrac{   \var(Y_{i2}|X_{i1}=X_{i2}=x) }{ \var(Y_{i1}|X_{i1}=X_{i2}=x) }.
\]</span></p>
</section>
<section id="location-effect-and-average-of-phi" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="location-effect-and-average-of-phi"><span class="header-section-number">15.2.2</span> Location Effect and Average of <span class="math inline">\(\phi\)</span></h3>
<p>To obtain the location effect <span class="math inline">\(\mu(\cdot)\)</span> and <span class="math inline">\(\E[\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x]\)</span>, we instead look at the averages of the realized outcomes for stayers. By model (<a href="#eq-nonparametric-loc-scale-model" class="quarto-xref"><span>15.1</span></a>) it holds that <span class="math display">\[
\begin{aligned}
    \E[Y_{i1}|X_{i1}=X_{i2}=x] &amp; = \E[\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x], \\
    \E[Y_{i2}|X_{i1}=X_{i2}=x] &amp; = \mu(x) + \sigma(x)\E[\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x].
\end{aligned}
\]</span> Identification for <span class="math inline">\(\E[\phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x]\)</span> is thus immediate. To obtain <span class="math inline">\(\mu(\cdot)\)</span>, we rearrange and multiply the first line by <span class="math inline">\(\sigma(x)\)</span>: <span class="math display">\[
\begin{aligned}
    \mu(x) &amp; = \E[Y_{i2}|X_{i1}=X_{i2}=x] - \sigma(x)\E[Y_{i1}|X_{i1}=X_{i2}=x] \\
    &amp; = \E[Y_{i2}|X_{i1}=X_{i2}=x] \\
    &amp; \quad - \sqrt{\dfrac{ \var(Y_{i1}|X_{i1}=X_{i2}=x) }{ \var(Y_{i1}|X_{i1}=X_{i2}=x) }}\E[Y_{i2}|X_{i1}=X_{i2}=x] .
\end{aligned}
\]</span></p>
</section>
<section id="average-derivative-of-phi" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="average-derivative-of-phi"><span class="header-section-number">15.2.3</span> Average Derivative of <span class="math inline">\(\phi\)</span></h3>
<p>Finally, having identified <span class="math inline">\(\mu(\cdot)\)</span> and <span class="math inline">\(\sigma(\cdot)\)</span>, we can now proceed to identify <span class="math inline">\(\E[\partial_x \phi(x, A_i, U_{it})|X_{i1}=X_{i2}=x]\)</span>. To do so, we define new synthetic outcomes that eliminate the location-scale effects, reducing the problem to the stationary case (<a href="nonparametric-introduction.html#eq-nonparametric-model-full-nonsep" class="quarto-xref"><span>11.4</span></a>): <span class="math display">\[
\begin{aligned}
Z_{i1} &amp; = Y_{i1}, \\
Z_{i2} &amp; = \dfrac{Y_{i2}- \mu(X_{i2})}{\sigma(X_{i2})}.
\end{aligned}
\]</span></p>
<p>The new variables <span class="math inline">\((Z_{i1}, Z_{it})\)</span> satisfy two key properties:</p>
<ul>
<li>The distribution of <span class="math inline">\((Z_{i1}, Z_{i2}, X_{i1}, X_{i2})\)</span> is identified.</li>
<li>The variables follow <span class="math display">\[
Z_{it} = \phi(X_{it}, A_i, U_{it}).
\]</span></li>
</ul>
<p>In other words, <span class="math inline">\((Z_{i1}, Z_{i2})\)</span> follow model (<a href="nonparametric-introduction.html#eq-nonparametric-model-full-nonsep" class="quarto-xref"><span>11.4</span></a>).</p>
<p>By applying the results of sections <a href="nonparametric-average-identification.html" class="quarto-xref"><span>13</span></a>-<a href="nonparametric-average-estimation.html" class="quarto-xref"><span>14</span></a> we conclude that <span class="math display">\[
\begin{aligned}
    &amp; \E[\partial_x\phi (x, A_i, U_{it})|X_{i1}=X_{i2}=x] \\
    &amp; = \partial_{x_2} \E\left[ Z_{i2}- Z_{i1}|X_{i1}=x_1, X_{i2} = x_2 \right]\Big|_{(x_1, x_2)=(x, x)}.
\end{aligned}
\]</span></p>
<p>Combining the above results together yields overall identification for average marginal effects (<a href="#eq-nonparametric-loc-scale-t1" class="quarto-xref"><span>15.2</span></a>) and (<a href="#eq-nonparametric-loc-scale-t2" class="quarto-xref"><span>15.3</span></a>).</p>
</section>
</section>
<section id="estimation" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="estimation"><span class="header-section-number">15.3</span> Estimation</h2>
<p>Estimation of (<a href="#eq-nonparametric-loc-scale-t1" class="quarto-xref"><span>15.2</span></a>) and (<a href="#eq-nonparametric-loc-scale-t2" class="quarto-xref"><span>15.3</span></a>) is now straightforward. As in section <a href="nonparametric-average-estimation.html" class="quarto-xref"><span>14</span></a>, we have shown that the objects of interest can be expressed in terms of explicit functions of conditional expectations of <span class="math inline">\((Y_{i1}, Y_{i2})\)</span> given <span class="math inline">\((X_{i1}, X_{i2})\)</span>. This expectations can be replaced with local polynomial estimators, following the logic of section <a href="nonparametric-average-estimation.html" class="quarto-xref"><span>14</span></a>. The resulting estimator for the average marginal effects of interest will be consistent and asymptotically normal by the delta method, as local polynomial estimators are consistent and jointly asymptotically normal.</p>
<p>For inference, the simplest approach is to use the bootstrap rather than use the expression for the variance implied by the delta method. Accordingly, the simplest way to conduct valid inference is by using bootstrap and recomputing all conditional expectations. See <span class="citation" data-cites="Chernozhukov2015">Chernozhukov et al. (<a href="../references/references.html#ref-Chernozhukov2015" role="doc-biblioref">2015</a>)</span> regarding bootstrap inference, and also alternative estimation using global methods (as opposed to the local polynomial approach).</p>
<hr>
<section id="next-section" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="next-section">Next Section</h4>
<p>In the next section, we extend our identification results for average marginal effects beyond the population of stayers using restrictions on the dependence between <span class="math inline">\((A_i, U_{it})\)</span> and <span class="math inline">\(X_{it}\)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Chernozhukov2015" class="csl-entry" role="listitem">
Chernozhukov, Victor, Iván Fernández-Val, Stefan Hoderlein, Hajo Holzmann, and Whitney Newey. 2015. <span>“<span class="nocase">Nonparametric Identification in Panels Using Quantiles</span>.”</span> <em>Journal of Econometrics</em> 188 (2): 378–92. <a href="https://doi.org/10.1016/j.jeconom.2015.03.006">https://doi.org/10.1016/j.jeconom.2015.03.006</a>.
</div>
<div id="ref-Huntington-Klein2025EffectIntroductionResearch" class="csl-entry" role="listitem">
Huntington-Klein, Nick. 2025. <em>The <span>Effect</span>: <span>An Introduction</span> to <span>Research Design</span> and <span>Causality</span></em>. S.l.: <span>Chapman and Hall/CRC</span>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/vladislav-morozov\.github\.io\/econometrics-heterogeneity\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../nonparametric/nonparametric-average-estimation.html" class="pagination-link" aria-label="Nonparametric Estimation of Average Effects">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Nonparametric Estimation of Average Effects</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references/references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/vladislav-morozov/econometrics-heterogeneity/edit/main/src/nonparametric/nonparametric-location-scale.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/vladislav-morozov/econometrics-heterogeneity/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>